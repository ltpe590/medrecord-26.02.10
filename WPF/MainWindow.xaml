<Window x:Class="WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:helpers="clr-namespace:WPF.Helpers"
        mc:Ignorable="d"
        Title="Patient Visit Management"
        Height="700" Width="1100"
        FontSize="16" FontWeight="Bold"
        WindowState="Maximized">

    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- TOP TOOLBAR -->
            <DockPanel Grid.Row="0" Background="#f0f0f0" Height="40" LastChildFill="False" Margin="5,0,5,0">
                <Button x:Name="ToggleLeftPanelButton" Content="Register New Patient" Width="170" Height="32" Margin="5,4,0,4" Background="#0078D4" Foreground="White" Click="AddNewPatientButton_Click" DockPanel.Dock="Left"/>
                <Button x:Name="SettingsButton" Content="⚙ Settings" Width="100" Height="32" Margin="0,4,10,4" Background="#6c757d" Foreground="White" Click="SettingsButton_Click" DockPanel.Dock="Right"/>
                <Button x:Name="ToggleRightPanelButton" Content="Previous Visits" Width="170" Height="32" Margin="0,4,5,4" Background="#0078D4" Foreground="White" Click="ToggleRightPanelButton_Click" DockPanel.Dock="Right"/>
                <Button x:Name="DebugButton" Content="🐛 Debug" Width="100" Height="32" 
        Click="DebugButton_Click" DockPanel.Dock="Right"/>
            </DockPanel>

            <!-- CENTRAL CONTENT (fills remaining width/height) -->
            <ScrollViewer Grid.Row="1" x:Name="MainContentScrollViewer" VerticalScrollBarVisibility="Auto" PreviewMouseWheel="ScrollViewer_PreviewMouseWheel">
                <Grid Background="#f5f5f5" Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- LOGIN -->
                    <Expander Grid.Row="0" x:Name="LoginExpander" Header="Login to Medical Records System" Background="#f0f0f0" Padding="5" Margin="0,0,0,10">
                        <StackPanel Background="White" Margin="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Login Button -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Username Label -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Username TextBox -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Password Label -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Password PasswordBox -->
                                    <ColumnDefinition Width="*" />
                                    <!-- API URL Label -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- API URL TextBox -->
                                    <ColumnDefinition Width="Auto" />
                                    <!-- Status TextBox -->
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" x:Name="LoginButton" Content="Login" Width="80" Height="35" Margin="5" Background="#0078D4" Foreground="White" Click="LoginButton_Click"/>
                                <Label Grid.Column="1" Content="Username:" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                <TextBox Grid.Column="2" x:Name="TxtUsername" Text="{Binding Username, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Width="150" Height="25" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                <Label Grid.Column="3" Content="Password:" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                <PasswordBox Grid.Column="4" x:Name="TxtPassword" helpers:PasswordBoxHelper.BoundPassword="{Binding Password, Mode=TwoWay}" Width="150" Height="25" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                <TextBox Grid.Column="5" x:Name="StatusText" Margin="10,0,5,0" VerticalAlignment="Center" Foreground="Gray" FontStyle="Italic" IsReadOnly="True" BorderThickness="0" Background="Transparent" TextWrapping="NoWrap" MinWidth="200" />
                            </Grid>
                        </StackPanel>
                    </Expander>

                    <!-- PATIENT MANAGEMENT -->
                    <Expander Grid.Row="1" x:Name="PatientManagementExpander" Header="Patient Management" IsExpanded="{Binding IsPatientExpanderOpen}" Padding="5" Margin="0,0,0,10">

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" MinWidth="250"/>
                                    <ColumnDefinition Width="Auto" MinWidth="350"/>
                                </Grid.ColumnDefinitions>

                                <!-- Patient ListBox (Column 0) -->
                                <ListBox x:Name="PatientListBox" Grid.Column="0" Height="200" ItemsSource="{Binding Patients}" SelectedItem="{Binding SelectedPatient}" MouseDoubleClick="PatientListBox_MouseDoubleClick">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding DisplayName}" Padding="5"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>


                                <!-- Search and Details Panel (Column 1) -->
                                <StackPanel Grid.Column="1" Margin="15,0,0,0">

                                    <!-- Search Box Grid -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="70" />
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="TxtPatientSearch" Height="30" Margin="0,0,10,0" TextChanged="TxtPatientSearch_TextChanged"/>
                                        <Button Grid.Column="1" Content="Search" />
                                    </Grid>

                                    <!-- Action Buttons Grid -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0" Height="30" Content="Refresh" Margin="0,0,5,0" Click="RefreshPatientsButton_Click"/>
                                        <Button Grid.Column="1" Height="30" Content="Add New Patient" Background="#28a745" Foreground="White" Margin="5,0,0,0" Click="AddNewPatientButton_Click"/>
                                    </Grid>

                                    <!-- Selected Patient Display Border -->
                                    <Border x:Name="SelectedPatientBorder" Visibility="Visible" Padding="10" BorderThickness="1" BorderBrush="LightGray" Background="#f9f9f9">
                                        <StackPanel>
                                            <TextBlock Text="Selected Patient" FontWeight="Bold"/>
                                            <TextBlock x:Name="SelectedPatientInfo" Margin="0,5,0,0"/>
                                            <TextBlock x:Name="SelectedPatientDetails" Foreground="Gray" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <!-- PAUSED VISITS SECTION (Grid.Row="1") -->
                            <Border Grid.Row="1" Background="#e8f4fd" BorderBrush="#0078d4" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,15,0,0">
                                <StackPanel>
                                    <TextBlock Text="⏸ Paused Visits" FontWeight="Bold" FontSize="14" Foreground="#0078d4" Margin="0,0,0,10"/>
                                    <!-- Paused Visits Button Grid -->
                                    <ScrollViewer Height="120" VerticalScrollBarVisibility="Auto">
                                        <UniformGrid x:Name="PausedVisitsButtonGrid" Columns="5" Rows="3" Margin="0,0,0,5"/>
                                    </ScrollViewer>
                                    <TextBlock x:Name="NoPausedVisitsText" Text="No paused visits" FontStyle="Italic" Foreground="Gray" HorizontalAlignment="Center" Margin="0,10,0,0"/>
                                </StackPanel>
                            </Border>

                        </Grid>
                    </Expander>

                    <!-- VISIT MANAGEMENT -->
                    <Expander Grid.Row="2" x:Name="VisitManagementExpander" Header="{Binding VisitHeaderText}" IsExpanded="{Binding IsVisitExpanderOpen}" Padding="5">
                        <Expander.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Visit Management" FontWeight="Bold"/>
                                    <TextBlock x:Name="VisitHeaderPatientName" Margin="10,0,0,0" FontStyle="Italic" Foreground="Gray"/>
                                </StackPanel>
                            </DataTemplate>
                        </Expander.HeaderTemplate>

                        <!-- Vital Signs Section -->
                        <StackPanel Margin="5">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"  Margin="0,5,0,15">
                                <Label Content="Temp °C" VerticalAlignment="Center"/>
                                <TextBox x:Name="TxtTemperature" Width="80" VerticalAlignment="Center" Margin="0,0,20,0"/>
                                <Label Content="BP" VerticalAlignment="Center"/>
                                <TextBox x:Name="TxtBPS" Width="60" VerticalAlignment="Center" Margin="0,0,2,0"/>
                                <TextBlock Text="/" VerticalAlignment="Center" Margin="0,0,2,0"/>
                                <TextBox x:Name="TxtBPD" Width="60" VerticalAlignment="Center" Margin="0,0,20,0"/>
                                <Label Content="GPA" VerticalAlignment="Center"/>
                                <TextBox x:Name="TxtGravida" Width="50" VerticalAlignment="Center" Margin="0,0,2,0"/>
                                <TextBox x:Name="TxtPara" Width="50" VerticalAlignment="Center" Margin="0,0,2,0"/>
                                <TextBox x:Name="TxtAbortion" Width="50" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Diagnosis Section -->
                            <Label Content="Diagnosis:" HorizontalAlignment="Left" Width="250" Margin="0,-50,0,0"/>
                            <TextBox x:Name="TxtDiagnosis" Height="30" Margin="0,0,0,10"/>

                            <!-- Lab Panel Section (MVVM example from original code) -->
                            <StackPanel x:Name="LabPanel" Visibility="Visible">
                                <!-- Note: This section assumes you have bindings set up in C# -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <ComboBox ItemsSource="{Binding Tests}" 
                           SelectedItem="{Binding SelectedTest}"
                           DisplayMemberPath="TestName"
                           Width="200"/>
                                    <TextBox Text="{Binding ResultValue}" Width="120" Margin="5,0"/>
                                    <Button Content="Add (MVVM)" Command="{Binding SaveCommand}" Margin="5,0"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Lab Panel Section (Code-behind example from original code) -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <ComboBox x:Name="CmbTests" Width="200" DisplayMemberPath="TestName"/>
                                <TextBox x:Name="TxtResultValue" Width="120" Margin="5,0" Text="Result"/>
                                <Button Content="Add (Code Behind)" Click="AddLabResultButton_Click" Margin="5,0"/>
                            </StackPanel>

                            <!-- Prescriptions Section -->
                            <Label Content="Prescriptions:" Margin="0,0,0,0"/>
                            <TextBox x:Name="TxtPrescriptions" Height="80" Margin="0,0,0,10"/>

                            <!-- Notes Section -->
                            <Label Content="Notes:"/>
                            <TextBox x:Name="TxtNotes" Height="80" Margin="0,0,0,10"/>

                            <!-- Action Buttons Section -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                                <Button x:Name="SaveVisitButton" Content="Save Visit" Width="120" Height="35" Background="#0078D4" Foreground="White" Click="SaveVisitButton_Click" Margin="0,0,10,0"/>
                                <Button Content="Print Summary" Width="120" Height="35" Background="#6c757d" Foreground="White" Click="PrintSummaryButton_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Expander>
                </Grid>
            </ScrollViewer>
        </Grid>

        <Border x:Name="RightPanelBorder"
                Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                Canvas.ZIndex="1"
                Width="400"
                HorizontalAlignment="Right"
                Background="White"
                BorderBrush="#e0e0e0"
                BorderThickness="1,0,0,0"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="#0078D4" BorderBrush="#e0e0e0" BorderThickness="0,0,0,1">
                    <DockPanel LastChildFill="True">
                        <Button DockPanel.Dock="Right" x:Name="CloseRightPanelButton" Content="❌" FontSize="26" FontWeight="Bold" Click="CloseRightPanelButton_Click" Background="Transparent" BorderThickness="0"  Margin="10,0,5,0"/>
                        <TextBlock Text="Previous Visits" VerticalAlignment="Center" FontWeight="Bold" Padding="10"/>
                    </DockPanel>
                </Border>
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Background="White" Margin="10">
                        <!-- Add content for previous visits here -->
                        <TextBlock x:Name="HistoryTextBlock" Text="Patient's Visits History visits will go here." FontStyle="Italic" Foreground="Gray" Margin="10"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>

    </Grid>
</Window>
